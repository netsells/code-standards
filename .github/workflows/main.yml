name: Build and Deploy

on:
    push:
        branches:
            - master

jobs:
    build-and-deploy:
        runs-on: [ self-hosted, linux, amazon-linux ]
        steps:
            -   name: Reset permissions
                run: sudo chown -R $USER:$USER $GITHUB_WORKSPACE

            -   name: Checkout
                uses: actions/checkout@master

            -   name: Use Node.js
                uses: actions/setup-node@v2-beta

            -   uses: bahmutov/npm-install@v1

            -   name: Install yarn
                run: npm install -g yarn

            -   name: Build and Deploy
                uses: JamesIves/github-pages-deploy-action@master
                env:
                    ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
                    BASE_BRANCH: master # The branch the action should deploy from.
                    BRANCH: gh-pages # The branch the action should deploy to.
                    FOLDER: docs # The folder the action should deploy.
                    BUILD_SCRIPT: yarn && yarn build

            -   name: Uninstall yarn
                run: npm uninstall -g yarn
